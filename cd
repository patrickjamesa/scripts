cd()                                                                         #@ Change directory, storing new directory on DIRSTACK

{

local dir error               ## variables for directory and return code

while :                       ## ignore all options

do

case $1 in
--) break ;;
-*) shift ;;
*) break ;;
esac

done
dir=$1

if [ -n "$dir" ]             ## if a $dir is not empty
then
pushd "$dir"                 ## change directory

else
pushd "$HOME"                ## go HOME if nothing on the command line
fi 2>/dev/null               ## error message should come from cd, not pushd

error=$?                     ## store pushd's exit code

if [ $error -ne 0 ]          ## failed, print error message
then
    builtin cd "$dir"        ## let the builtin cd provide the error message
fi

return "$error"              ## leave with pushd's exit code


} > /dev/null
